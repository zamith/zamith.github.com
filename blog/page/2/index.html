
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Crazy Little Hacks</title>
  <meta name="author" content="Zamith">

  
  <meta name="description" content="Imagine you have a class which gets XML data, parses it and then stores the
parsed data on a database. You could very well write it like this: 1
2
3 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://zamith.github.io/blog/page/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/CrazyLittleHacks" rel="alternate" title="Crazy Little Hacks" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26971772-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Crazy Little Hacks</a></h1>
  
    <h2>Some little hacks and random thoughts on what interests me at the moment in the area of computer science.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/CrazyLittleHacks" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://www.duckduckgo.com/" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:zamith.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/06/dependency-injection/">Dependency Injection</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-06T00:18:00+01:00" pubdate data-updated="true">Oct 6<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Imagine you have a class which gets XML data, parses it and then stores the
parsed data on a database. You could very well write it like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Consumer</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="n">parsed_data</span> <span class="o">=</span> <span class="no">XMLParser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="no">DB</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">parsed_data</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>There is (at least) one big problem with this approach, and it will manifest
itself when you want to support another data format, such as JSON. The Consumer
class is tightly coupled with the XMLParser, and therefore it&#8217;s hard to add
other parsers, so we need to decouple them. We&#8217;re
going to do that using a technique called Dependency Injection, like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Consumer</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:parser</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="ss">parser</span><span class="p">:</span> <span class="no">XMLParser</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@parser</span> <span class="o">=</span> <span class="n">parser</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>    <span class="no">DB</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">parsed_data</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This way we can inject the parser on initialization, or even after that. Note
that we have a default which is the XMLParser, but it is not mandatory to have a
default value.</p>

<p>So, after the refactoring, adding a JSONParser is easy.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">consumer</span> <span class="o">=</span> <span class="no">Consumer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">parser</span><span class="p">:</span> <span class="no">JSONParser</span><span class="p">)</span>
</span><span class='line'><span class="n">consumer</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This technique can be used in many scenarios, in this example we used it as part
of a pattern that&#8217;s called <a href="http://en.wikipedia.org/wiki/Strategy_pattern">strategy pattern</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/27/join-2013/">JOIN 2013</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-27T15:35:00+01:00" pubdate data-updated="true">Jun 27<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here are the slides of the presentation I gave at <a href="http://join.di.uminho.pt">JOIN&#8217;13</a> about the basics of ruby.</p>

<script async class="speakerdeck-embed" data-id="843f42e0c164013084f052870c8106fa" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>


<h3>Special Thanks</h3>

<p>I would like to thank Gon√ßalo Silva for the help with the examples and also <a href="http://zachholman.com/">Zach Holman</a> for the inspiration for the talk design from his awesome blog post called <a href="http://zachholman.com/posts/slide-design-for-developers/">Slide Design for Developers</a> and for the <a href="http://zachholman.com/talk/product-is-the-byproduct/">talk that inpired it</a>.</p>

<p>You can check more of his talks <a href="http://zachholman.com/talks">here</a>, if you ever need inspiration.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/02/testing-magic/">Testing Magic</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-02T11:45:00+01:00" pubdate data-updated="true">Jun 2<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>These are the slides of the presentation I gave at <a href="http://www.facebook.com/events/335214813245111/permalink/335216136578312/?notif_t=like">MinhoRB</a> about test driven development.</p>

<script async class="speakerdeck-embed" data-id="d9325770ad9e01308a815ef916064fe5" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>


<h3>Resources</h3>

<p>There are a bunch of links to resources on this topic in one of the last slides.</p>

<p>You can also check the code samples from the talk on <a href="https://github.com/minhorb/testing-magic">github</a>.</p>

<h3>Special Thanks</h3>

<p>I would like to thank <a href="http://zachholman.com/">Zach Holman</a> for the inspiration for the talk design from his awesome blog post called <a href="http://zachholman.com/posts/slide-design-for-developers/">Slide Design for Developers</a> and for the <a href="http://zachholman.com/talk/ruby-patterns/">talk that inpired it</a>.</p>

<p>You can check more of his talks <a href="http://zachholman.com/talks">here</a>, if you ever need inspiration.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/18/a-good-merge-commit/">A Good Commit Message</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-18T18:05:00+01:00" pubdate data-updated="true">May 18<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Lately I came to realise that one of the most important things in a team&#8217;s
development process is good documentation of what everyone&#8217;s been doing.</p>

<p>If you know me well enough you&#8217;ll know that I hate documentation, which seems
rather contradictory, but I think it all boils down to what good documentation
means.</p>

<p>Good documentation, in my opinion, are not wikis, a bunch of shared documents,
progress reports, etc&#8230; That&#8217;s management crap. All a development team needs is
a commit history with good commit messages.</p>

<p>Note: I&#8217;m using git and git nomenclature as an example, but this applies to any
versioning system.</p>

<h2>Commit Message Example</h2>

<p><img src="/images/commit_message.png" alt="commit-msg" /></p>

<p>Here&#8217;s an example of what I consider a good enough commit message. It is
composed of three parts:</p>

<ol>
<li>A first line of no more than 80 characters that sums up the purpose of the
commit</li>
<li>One or two paragraphs to explain the changes from a user point of view (user
story if available)</li>
<li>A bullet list of technical modifications of note</li>
</ol>


<h2>Integration into the flow</h2>

<p>If you follow a flow that&#8217;s similar to
<a href="http://blog.zamith.pt/blog/2013/01/30/developing-quality-code/">mine</a>, you
don&#8217;t need to worry about writing this messages in every commit, since that
would be tedious.</p>

<p>What I do is, when on a topic/feature branch I commit at will, with any message
I see fit at the moment. This well written message comes only when creating a
pull-request, so that someone doing a code review can better understand the
changes.</p>

<h2>Conclusion</h2>

<p>This way of doing commits, in my opinion, make it really nice to read through
the git log of summaries, and when in doubt of what a commit does, it&#8217;s easy to
get more info, providing a nice way of developing as a team. Although it&#8217;s also
a reminder of why something was done that way, for when you&#8217;re looking at the
code some time later.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/10/understanding-the-heart-to-become-a-better-doctor/">Understanding the Heart to Become a Better Doctor</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-10T00:55:00+01:00" pubdate data-updated="true">Apr 10<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Yes, you read the title correctly, this is indeed a article about better
understanding the heart in order to become a better doctor. Of course that by
heart I mean testing and by doctor I mean developer.</p>

<p>The analogy is not that absurd, as matter of fact it is not absurd at all in my
opinion, as tests are the core of any application, especially one for the web.
Without tests an application won&#8217;t live long, it will probably be able to stay
alive for a while, but at the first need for change or growth, it will fester
and die. As a developer I much prefer not being around when such things happen,
and most of all I believe it is my duty to impede this from happening, it&#8217;s the
developer&#8217;s code of honour, it&#8217;s the reason I call myself a professional
developer.</p>

<p>As you can see I do have a very strong opinion on this subject, and I really am
suggesting that if your writing a web application without tests (preferably TDD
but not necessarily) you&#8217;re not only doing it wrong, but you&#8217;re being
unprofessional and utterly irresponsible. Plainly put, you should not be writing
code!</p>

<p>A little side note here to all of those starting in this business or that just
now have been introduced to testing, this article should be a good starting
point on your quest to a brighter future where tests lead the way. Moreover, you
should not include yourself in the group of irresponsible developers out there,
if you actually start testing, obviously. Testing is something that is rarely
introduced in CS majors and most starting developers don&#8217;t get to have an older
and more experienced mentor to teach them this stuff, so it&#8217;s really not your
fault and you have all my respect and appreciation for trying to learn this.
Also, not everyone has to be a professional developer, and that&#8217;s fine. Just
don&#8217;t try to impersonate one, that&#8217;s all I&#8217;m asking.</p>

<p>Now that we&#8217;re done with the contextualization let&#8217;s get to the juicy part of
the article, where I&#8217;ll introduce some basic concepts and keywords of testing (some
of which you might have already heard of) and slowly progress into more advanced
and &#8220;philosophical&#8221; ones.</p>

<h2>The religions</h2>

<p>TDD, BDD and traditional testing. This are the most adopted religions in the
testing community.</p>

<p>You&#8217;ll often see them referred to as methodologies, processes or even
philosophies, but I believe they&#8217;re more than that. As a developer this will
drive not only your code but also the way you think and solve problems. It&#8217;s a
way of life, so choose carefully and embrace it (well, maybe I&#8217;m being a bit
dramatic here, you can change your mind afterwards, trying to mix them too much
is ill advised, though).</p>

<h3>TDD</h3>

<p>Test driven development, as the name states, is when you let your tests drive
your application&#8217;s code. It is often coupled with an agile software development
process, as it too work in very short cycles composed of three phases:</p>

<ol>
<li><span class="red">Red</span> - You make a test for a feature you wish you had (usually it will test a
very specific part of that feature)</li>
<li><span class="green">Green</span> - You write only enough code to make the test pass, not more, not less
(at this point you should commit your work)</li>
<li><span class="refactor">Refactor</span> - You are now in a green field, where you have a solution that may
not be optimal but it works and a test to make sure that it ever stops
working you&#8217;ll know about it. This is the perfect time to think of a better
way of solving the problem</li>
</ol>


<p>This is the core of TDD, it states that if you repeat this cycle over and over
again you&#8217;ll have smaller and more focused classes, looser
<a href="http://robots.thoughtbot.com/post/23112388518/types-of-coupling">coupling</a> and
cleaner interfaces.</p>

<p>There is, AFAIK, no real proof of this, but TDD does provide you a great test
suite, which combined with a control version system gives you much more
confidence in your code, as well as more freedom to change things and  an easier
way to debug regressions also, (and some might argue this is the greatest
benefit of TDD) if done right, you get documentation for free.</p>

<p>TDD can actually be divided into two subgroups, according to Martin Fowler, the
classical and the mockists, but we&#8217;ll get to that later on.</p>

<p>Right about now you should be wondering, &#8220;if TDD is so great, why even bother
having other ways of testing?&#8221;. It turns out that TDD is not perfect, mostly due
to our own faults as developers, such as the tests failing to cover an important
edge case or the tests being badly written leaving us a bigger code base to
maintain. Another problem might be that we as overzealous as we are, try to test
every possible scenario for every little bit of code, this is counter productive
and to know what and how much to test is a kind of art that will come with
experience (we&#8217;ll cover some ground rules that make this an easier task,
though).</p>

<p>When doing TDD (or any kind of tests) there is one thing you should be
constantly aware of, &#8220;your code is NOT bug free!&#8221;. Rest assured, bugs will
appear, but they will probably not be on your main flow of things, and when
they&#8217;re fixed, they&#8217;ll stay fixed.</p>

<p>Uncle Bob Martin describes TDD in <a href="http://butunclebob.com/ArticleS.UncleBob.TheThreeRulesOfTdd">three basic rules/laws</a>:</p>

<ol>
<li>You are not allowed to write any production code unless it is to make a
failing unit test pass.</li>
<li>You are not allowed to write any more of a unit test than is sufficient to
fail; and compilation failures are failures.</li>
<li>You are not allowed to write any more production code than is sufficient to
pass the one failing unit test.</li>
</ol>


<p>One of, if not the most important thing in TDD is that you write your own tests.
I like to go a bit further and say that the tests are part of the code.</p>

<h2>BDD</h2>

<p>Behaviour Driven Development is largely based on TDD, it differs mainly in the
fact that it focus in the behaviour of things instead of how they work, which is
why BDD always starts by defining a scenario. Plainly put, you focus primarily
on the user interaction and the user&#8217;s point of view.</p>

<p>For instance, imagine you would like to implement and ATM, with TDD you would
probably start by testing if the withdrawal and card validation mechanisms,
whereas with BDD you would write a scenario such as this:</p>

<figure class='code'><figcaption><span>Scenario 1: Account is in credit</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='cucumber'><span class='line'><span class="k">Given </span><span class="nf">the account is in credit</span>
</span><span class='line'><span class="k">And </span><span class="nf">the card is valid</span>
</span><span class='line'><span class="k">And </span><span class="nf">the dispenser contains cash</span>
</span><span class='line'><span class="k">When </span><span class="nf">the customer requests cash</span>
</span><span class='line'><span class="k">Then </span><span class="nf">ensure the account is debited</span>
</span><span class='line'><span class="k">And </span><span class="nf">ensure cash is dispensed</span>
</span><span class='line'><span class="k">And </span><span class="nf">ensure the card is returned</span>
</span></code></pre></td></tr></table></div></figure>


<p>Almost everything else in TDD will also apply here, but this small change in
perspective will have a deep impact in the resulting solution.</p>

<p>This type of scenarios have some rules, though, they have a special syntax so
that they can be understood by the non-technical people of the team or company,
but also so that they can be automated. As a matter of fact, doing this you have
not only a test suite, but also a pretty good documentation and feature
specification.</p>

<p>When writing scenarios I tend to prefer to write them declarative as opposed to
imperative, as I feel that otherwise it would pretty much defeat the whole
purpose of writing them. Here&#8217;s a <a href="http://benmabey.com/2008/05/19/imperative-vs-declarative-scenarios-in-user-stories.html">pretty good take on the differences</a></p>

<p>If you ever tried TDD you probably have faced the &#8220;what do I test first&#8221;
situation, BDD sets to solve that as you always start with the scenario and let
it drive you. In the example above you would first write a failing test that
would check that the account has credit, and then make pass, then you would
write a failing test for the card validation and make it pass, and so on. Bare
in mind though that making these tests pass may require going to different
layers of the application and further testing, but you&#8217;ll always know what to
test first.</p>

<p>BDD is more elegantly described by it&#8217;s creator Dan North from whom I took the
ATM example in <a href="http://dannorth.net/introducing-bdd/">this article</a>.</p>

<h2>Traditional Testing</h2>

<p>I call this traditional testing for the lack of a better term, but this is the
model you&#8217;ll see in companies that adopt very strict development methodologies
such as <a href="http://en.wikipedia.org/wiki/Waterfall_model">waterfall</a> or
<a href="http://en.wikipedia.org/wiki/IBM_Rational_Unified_Process">RUP</a>, and it happens
when there is an entire team whose only purpose in life is to do write tests.</p>

<p>In this model the tests start to be written after the development is complete,
IMHO it some serious drawbacks (even though I&#8217;ve never personally used it, I
must admit):</p>

<ol>
<li>The tests and it&#8217;s expectations don&#8217;t drive the code and the probability of
having poorly written, extremely coupled code is much higher</li>
<li>Management is always pushing for deliverables and/or deploys, in the event of
delays the test phase will be the first to suffer the consequences</li>
</ol>


<p>Even if the test process starts in sync with development process it is harder
and less productive to have someone else write the tests for your code as you&#8217;re
writing it.</p>

<p>In case you haven&#8217;t yet figured out, I&#8217;m nor a big fan, nor a big connoisseur of
this type of testing, still I did not want to go by without mentioning the ways
of the past.</p>

<h2>Going a bit further into TDD</h2>

<p>The main focus of the rest of this article is going to be TDD with Rails, but as
I&#8217;ve said earlier TDD has two subgroups, from which I&#8217;ll choose one (not 100%,
but almost) and even borrow a few high level concepts from BDD.</p>

<h3>Classical TDD</h3>

<p>When writing tests, classical TDDers will not use mocks and use stubs as little
as possible, mostly to fake web services and the such. They focus entirely on
the final state of the system, in the ATM example, they would test that the machine
has given money to the user, for example.</p>

<p>In this approach the tests for an object will test it&#8217;s functionality as well
as it&#8217;s neighbours&#8217;.</p>

<h3>Mockist TDD</h3>

<p>Mockist TDDers will use mocks to filters everything that is not the SUT (System
Under Test). Taking the ATM example one more time and imagining the SUT is the
card validator, they would test that if the card is valid, the
<code>give_money_to_user</code> method was called on the money dispenser. The focus here is
on behaviour instead of state.</p>

<p>In this approach the tests for an object will test it&#8217;s functionality as well
as it&#8217;s communication with it&#8217;s neighbours.</p>

<p>Check out Martin Fowler&#8217;s
<a href="http://martinfowler.com/articles/mocksArentStubs.html">article</a> on this for a
much more in depth analysis of the difference between classical and mockists
TDDers, as well as the difference between mocks and stubs.</p>

<h2>Outside-in testing</h2>

<p>Outside-in testing is a process that goes pretty much hand in hand with BDD in
terms of where it begins. When doing this we start by writing an integration or
acceptance test (this could be a BDD scenario), and go from there.</p>

<p>The main purpose here is to let the code be driven by the feature the clients
actually want, so you don&#8217;t start coding away before having a good grasp on how
the user experience is going to be.</p>

<p>This process plays well with both BDD and TDD, it&#8217;s really up to you which
religion to live by. I tend to prefer the mockist TDD approach, which is kind of
a hybrid, and I&#8217;ll explain in full detail how to do it in a Rails app.</p>

<p>For a thorough example of outside-in testing, please refer to <a href="http://rubylearning.com/blog/2010/10/05/outside-in-development/">Harold Gimenez article</a>.</p>

<h3>Middle-out testing</h3>

<p>Another way of doing tests would be to start by the core classes of your system,
and work your way to the layers, such as UI and database. In Rails this would
translate to first write tests and respective code for the most important models
and controllers, and they work your way to migration, validations, etc, as well
as the views.</p>

<p>I&#8217;ve taken this approach several times and discourage you from doing so, because
this will probably lead to adding too much features to your system, and make the
final system to not accurately represent the clients wishes.</p>

<h2>Final Notes</h2>

<p>I believe we covered a lot of ground here, there is however, a lot more you can
do to become a more proficient tester and therefore a better developer.</p>

<p>In my opinion you should really focus on two things if you indeed intend to
improve your code&#8217;s quality through testing, write and read, simple as that.</p>

<p>You should definitely write a lot of tests so you can face the problems, and
have your own doubts. That&#8217;s how you learn any programming language, principle
or methodology, by hitting your head on the wall until you realize there&#8217;s a
door right beside you.</p>

<p>You should also read a lot, so that that door becomes easier to find and open.
Throughout the article I&#8217;ve provide some links you should really go ahead and
read if you haven&#8217;t done so already, but I&#8217;ll leave some more extensive reading
material (and some screencasts) I recommend.</p>

<ul>
<li><a href="http://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882">Clean Code</a></li>
<li><a href="http://www.cleancoders.com">Clean Coders</a></li>
<li><a href="https://learn.thoughtbot.com/purchases/d27fb3e007037d4ef543caf84d87ecc7">Test-Driven Rails</a></li>
<li><a href="http://www.amazon.com/RSpec-Book-Behaviour-Development-Cucumber/dp/1934356379">The Rspec Book</a></li>
<li><a href="http://blog.carbonfive.com/2012/02/14/beginning-outside-in-rails-development-with-cucumber-and-rspec/">Beginning Outside-In Rails Development with Cucumber and RSpec</a></li>
<li><a href="http://www.amazon.com/Test-Driven-Development-By-Example/dp/0321146530?tag=giantrobotssm-20">Test Driven Development: By Example</a></li>
<li><a href="https://peepcode.com/products/rspec-i">RSpec 2: The Basics</a></li>
<li><a href="https://peepcode.com/products/rspec-ii">RSpec 2: Tools</a></li>
</ul>


<p>Now go and TDD away. And most of all try to have fun doing it (pairing is a nice
way of achieving this).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/01/faster-controller-tests/">Faster Controller Tests</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-01T14:20:00+01:00" pubdate data-updated="true">Apr 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A big issue with doing TDD is having fast test, or else running your tests will slow down your development cycle. One thing I always try to do is hit the database as less as possible, since what your testing is almost never directly related to the database itself.</p>

<p>This is easy enough to do by stubbing out the calls to model or <code>ActiveRecord</code> code. On a real application though, you&#8217;ll usually have to authenticate users and/or do some kind of authorization. This too should not have to go through the database.</p>

<p>For authentication I&#8217;m using Devise and for authorization CanCan, and setting up a controller test on RSpec goes somewhat like this:</p>

<figure class='code'><figcaption><span>support file</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">controller_full_setup</span>
</span><span class='line'>  <span class="n">setup_devise</span>
</span><span class='line'>  <span class="n">setup_ability</span>
</span><span class='line'>  <span class="n">setup_host</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">setup_ability</span>
</span><span class='line'>  <span class="vi">@ability</span> <span class="o">=</span> <span class="no">Object</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="vi">@ability</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="ss">CanCan</span><span class="p">:</span><span class="ss">:Ability</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@controller</span><span class="o">.</span><span class="n">stub</span><span class="p">(</span><span class="ss">:current_ability</span><span class="p">)</span><span class="o">.</span><span class="n">and_return</span><span class="p">(</span><span class="vi">@ability</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">setup_host</span>
</span><span class='line'>  <span class="vi">@request</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;test.example.com&#39;</span>
</span><span class='line'>  <span class="n">default_url_options</span><span class="o">[</span><span class="ss">:host</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@request</span><span class="o">.</span><span class="n">host</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">setup_devise</span>
</span><span class='line'>  <span class="vi">@request</span><span class="o">.</span><span class="n">env</span><span class="o">[</span><span class="s2">&quot;devise.mapping&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="no">Devise</span><span class="o">.</span><span class="n">mappings</span><span class="o">[</span><span class="ss">:user</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>spec file</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;does something&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">controller_full_setup</span>
</span><span class='line'>  <span class="vi">@ability</span><span class="o">.</span><span class="n">can</span> <span class="ss">:do</span><span class="p">,</span> <span class="ss">:action</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># rest of the test</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this setup you are logged in to devise as a user, and have a blank cancan ability object in which you can define the abilities needed for the purpose of the test.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/09/jquery-turbolinks-and-asset-pipeline/">jQuery, Turbolinks and Asset Pipeline</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-09T21:19:00+00:00" pubdate data-updated="true">Mar 9<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve talked about turbolinks <a href="http://blog.zamith.pt/blog/2012/09/28/turbolinks/">before</a>, and it is awesome. Integrating it with jquery plugins or legacy code could be quite a <a href="http://reed.github.com/turbolinks-compatibility/">pain</a>, so jquery.turbolinks came to be.</p>

<p>It&#8217;s a pretty simple plugin that stores each callback you had on <code>DOM ready</code> and runs it on <code>page:change</code>, the turbolinks event.</p>

<p>So, you might think all your problems are solved, but it is not quite so. What if you want to run some code just for a specific page? Or include a file for a specific page?</p>

<p>Using turbolinks render the usage of stuff like <code>content_for :head</code> impossible, as the head will already be on cache, and the code you added to it will not run.</p>

<p>And if you try to add the code in the body, jquery.turbolinks will add the callback each time you go to the page, which means that if you visit the same page twice before a full page refresh, your code will also run twice. Not very good&#8230;</p>

<h3>Rails 3.1 asset pipeline</h3>

<p>The asset pipeline has three goals, precompile, concatenate and minify.</p>

<p>So, even though the rails generators create a .coffee file for each controller, the normal usage would be to have all of them concatenated into one, when in production. This file will be loaded on the home page and can be cached the rest of the way.</p>

<p>There are obviously some times when we might want to add some files in other places than the home page. For that we&#8217;ll have to create a new manifest files and explicitly tell rails to add it to the precompile path. A common usage for this is to have a <code>footer.js</code> manifest for files that are loaded after the rest of the body.</p>

<p>If we want to add such manifests to the body, using turbolinks and jquery.turbolinks, we&#8217;ll have the same problems if the code is actually trying to run code, and not just defining functions and variables.</p>

<h3>The pipeline trap</h3>

<p>A problem with having all you&#8217;re files concatenated is that you have to be extra careful with when and where you attach event listeners. For instance, if you attach an event to an li in the <code>posts.coffee</code> file, and it is then included in the <code>application.js</code> manifest, all the <code>li</code>&#8217;s in your application will have that listener.</p>

<p>There are two ways (that I know of) of solving this problem.</p>

<p>You can either add a class or id to the <code>body</code> element of each page, such as <code>posts_index</code> and then attach the listeners to the <code>li</code>&#8217;s only when the <code>body</code> has that attribute.</p>

<figure class='code'><figcaption><span>app/assets/javascripts/controller_name.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">$</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="k">if</span> <span class="nx">$</span><span class="p">(</span><span class="s">&#39;body.controller_name_action_name&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span class='line'>    <span class="o">//</span> <span class="nx">Do</span> <span class="nx">some</span> <span class="nx">stuff</span> <span class="nx">here</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>app/views/layouts/application.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="x">&lt;html&gt;</span>
</span><span class='line'><span class="x">&lt;head&gt;</span>
</span><span class='line'><span class="x">  &lt;title&gt;AppName&lt;/title&gt;</span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span>    <span class="s2">&quot;application&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">&quot;application&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">  </span><span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/head&gt;</span>
</span><span class='line'><span class="x">&lt;body class=&quot;</span><span class="cp">&lt;%=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:controller</span><span class="o">]</span><span class="si">}</span><span class="s2">_</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:action</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="cp">%&gt;</span><span class="x">&quot;&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'>
</span><span class='line'><span class="x">&lt;/body&gt;</span>
</span><span class='line'><span class="x">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Or you can encapsulate all your code into functions, and then make them visible in the page you want to call them on.</p>

<figure class='code'><figcaption><span>app/assets/javascripts/controller_name.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">$</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">random_function = </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Hello World&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nx">exports</span> <span class="o">||=</span> <span class="p">{}</span>
</span><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nv">exports.another_random_name = </span><span class="nx">random_function</span>
</span></code></pre></td></tr></table></div></figure>


<p>You need to export the functions because coffeescript will not let functions and variables defined in a file pollute the global scope, and the easiest way to do it a browser is to attach them to the <code>window</code> object which is always present. We add an <code>exports</code> namespace so that the <code>window</code> namespace will not be polluted with all our functions, but it would work even without it.</p>

<p>I tend to prefer the second approach for two reasons. First, and even though it adds JavaScript to the body, it is less obtrusive. And second, because it integrates with turbolinks, as it does not assume the code in the head is run every time.</p>

<h3>The Turbolinks Problem</h3>

<p>We still have a problem, though. Code that&#8217;s in the body running more than once.</p>

<p>The easier way I found of solve this was to use the once function from the <code>underscore</code> library. Obviously I was already using <code>underscore</code> for other stuff, or else it would be a complete overkill. If you just need this one function, define it somewhere that gets concatenated into your <code>application.js</code> file.</p>

<p>So, calling the function I defined above would look like this:</p>

<figure class='code'><figcaption><span>app/views/controller_name/action_name.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;script&gt;</span>
</span><span class='line'>  <span class="nx">jQuery</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">){</span>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">another_random_name</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}));</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And if you want to use the once function, give credit to Jeremy Ashkenas, Brad Dunbar and <a href="https://github.com/documentcloud/underscore/graphs/contributors">many others</a>, and go ahead and copy paste.</p>

<figure class='code'><figcaption><span>_.once function</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">_</span><span class="p">.</span><span class="nx">once</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">ran</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">memo</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">ran</span><span class="p">)</span> <span class="k">return</span> <span class="nx">memo</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">ran</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">memo</span> <span class="o">=</span> <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">func</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">memo</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/01/clean-code/">Clean Code</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-01T00:10:00+00:00" pubdate data-updated="true">Mar 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>These are the slides of the presentation I gave at <a href="http://www.facebook.com/events/335214813245111/permalink/335216136578312/?notif_t=like">MinhoRB</a> about clean code.</p>

<script async class="speakerdeck-embed" data-id="109dc5a0643301301b1e12313b100525" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>


<h3>Resources</h3>

<ul>
<li><a href="http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod">Principles of OOD</a></li>
<li><a href="http://blog.codeclimate.com/blog/2012/10/17/7-ways-to-decompose-fat-activerecord-models/">Decompose fat Active Record models</a></li>
<li><a href="https://learn.thoughtbot.com/products/13-ruby-science">Ruby Science</a></li>
<li><a href="http://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882">Clean Code</a></li>
<li><a href="http://www.amazon.com/Design-Patterns-Ruby-Russ-Olsen/dp/0321490452">Design Patterns in Ruby</a></li>
<li><a href="http://www.amazon.com/Rails-AntiPatterns-Refactoring-Addison-Wesley-Professional/dp/0321604814/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1362097264&amp;sr=1-1&amp;keywords=rails+antipatterns">Rails Anti Patterns</a></li>
<li><a href="http://robots.thoughtbot.com/">Thoughbot&#8217;s blog</a></li>
<li><a href="http://www.youtube.com/watch?v=L1G--mPscQM">Refactoring from Good to Great by Ben Orenstein</a></li>
</ul>


<h3>Special Thanks</h3>

<p>I would like to thank <a href="http://zachholman.com/">Zach Holman</a> for the inspiration for the talk design from his awesome blog post called <a href="http://zachholman.com/posts/slide-design-for-developers/">Slide Design for Developers</a> and for the <a href="http://zachholman.com/talk/how-github-uses-github-to-build-github/">talk that inpired it</a>.</p>

<p>You can check more of his talks <a href="http://zachholman.com/talks">here</a>, if you ever need inspiration.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/20/nested-eager-loading-with-active-record/">Nested Eager Loading With Active Record</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-20T22:50:00+00:00" pubdate data-updated="true">Feb 20<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Given that you have used Rails for a medium sized project, or that you are zealous with your queries to the database, you&#8217;ve probably heard of <code>activerecord</code>&#8217;s <code>includes</code> method to eager load relations in order to prevent the N+1 query problem.</p>

<p>Don&#8217;t fret if you haven&#8217;t, I&#8217;ll break it down for you. Imagine you have a <code>Post</code> model which may have one or more <code>Comment</code>, and that in your view you do something of the sort (assuming <code>@posts = Post.all</code>):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='erb'><span class='line'><span class="x">...</span>
</span><span class='line'><span class="cp">&lt;%</span> <span class="vi">@posts</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">  &lt;article&gt;</span>
</span><span class='line'><span class="x">    &lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">post</span><span class="o">.</span><span class="n">body</span> <span class="cp">%&gt;</span><span class="x">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="x">    &lt;footer&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%</span> <span class="n">post</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">comment</span><span class="o">|</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="x">&lt;%= comment.body </span><span class="err">%&gt;</span><span class="x">&lt;/p&gt;</span>
</span><span class='line'><span class="x">      </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">    &lt;/footer&gt;</span>
</span><span class='line'><span class="x">  &lt;/article&gt;</span>
</span><span class='line'><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this snippet, a query for fetching the comments is being performed for each post, so it&#8217;s N for N equal to the number of posts plus 1 queries to list the posts. For a big number of posts you&#8217;ll swamp your database.</p>

<p>In order to prevent this you can do <code>@posts = Post.includes(:comments).all</code> that will eager load all the comments of all the posts and store them in memory, so when you try to access them you don&#8217;t hit the database.</p>

<h3>Nested Eager Loading</h3>

<p>A feature that I find rather undocumented is that it is possible to eager load a relation of an object you&#8217;re eager loading, such as the author of a comment if you wanted to access it&#8217;s name or avatar, for example.</p>

<p>That can be achieved by passing an <code>Hash</code> as an argument to the <code>includes</code> method instead of a <code>Symbol</code>, for the example above it would be, <code>@posts = Post.includes(comments: :author).all</code>.</p>

<p>I have tried it to three levels of nesting which is already more than you should ever need, still it can go deeper than that, not sure how much deeper, though.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/09/debugging-rails/">Debugging Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-09T14:45:00+00:00" pubdate data-updated="true">Feb 9<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>There are many ways in which you can debug your Rails applications, I&#8217;m going to show you how to display the errors you get in a nice way, using Better Errors, and what to do when that just isn&#8217;t enough.</p>

<h3>Better Errors</h3>

<p>This was covered in great depth by Ryan Bates in a <a href="http://railscasts.com/episodes/402-better-errors-railspanel">RailsCasts #402</a>. After you install the gem, when you get an application error instead of this:</p>

<p><img src="/images/regular_error.png" alt="reg-error" /></p>

<p>You&#8217;ll be prompted with something like this:</p>

<p><img src="/images/better_errors.png" alt="better-error" /></p>

<p>Note that by adding <code>binding_of_caller</code> gem you&#8217;ll also have a REPL on the point of failure.</p>

<h3>Pry</h3>

<p>Better errors with a REPL is going to take care of most of your problems when doing a full stack request, but if you are developing some model classes or even some libraries in Rails or plain old Ruby, you may want to declare breakpoints so you can do some debugging.</p>

<p>Debbuging with <a href="https://github.com/pry/pry">pry</a> is as easy as droping the <code>binding.pry</code> line wherever you want the breakpoint, like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'> <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>   <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'>   <span class="nb">binding</span><span class="o">.</span><span class="n">pry</span>
</span><span class='line'> <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>When running this code, your server will stop at the breakpoint and you should see this:</p>

<p><img src="/images/pry.png" alt="better-error" /></p>

<p>This has been covered on <a href="http://railscasts.com/episodes/280-pry-with-rails">RailsCasts #280</a>. One thing Ryan doesn&#8217;t mention though is the <a href="https://github.com/rweng/pry-rails">pry-rails gem</a>, which will sub in as your rails console and give you some nicities as showing routes and the schema for a given model in a good looking way.</p>

<figure class='code'><figcaption><span>Pry-rails usage, from the README</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="err">$</span> <span class="n">rails</span> <span class="n">console</span>
</span><span class='line'><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">show</span><span class="o">-</span><span class="n">routes</span>
</span><span class='line'>     <span class="n">pokemon</span> <span class="no">POST</span>   <span class="sr">/pokemon(.:format)      pokemons#create</span>
</span><span class='line'><span class="sr"> new_pokemon GET    /</span><span class="n">pokemon</span><span class="o">/</span><span class="kp">new</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>  <span class="n">pokemons</span><span class="c1">#new</span>
</span><span class='line'><span class="n">edit_pokemon</span> <span class="no">GET</span>    <span class="sr">/pokemon/e</span><span class="n">dit</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span> <span class="n">pokemons</span><span class="c1">#edit</span>
</span><span class='line'>             <span class="no">GET</span>    <span class="sr">/pokemon(.:format)      pokemons#show</span>
</span><span class='line'><span class="sr">             PUT    /</span><span class="n">pokemon</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>      <span class="n">pokemons</span><span class="c1">#update</span>
</span><span class='line'>             <span class="no">DELETE</span> <span class="sr">/pokemon(.:format)      pokemons#destroy</span>
</span><span class='line'><span class="sr">        beer POST   /</span><span class="n">beer</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>         <span class="n">beers</span><span class="c1">#create</span>
</span><span class='line'>    <span class="n">new_beer</span> <span class="no">GET</span>    <span class="sr">/beer/ne</span><span class="n">w</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>     <span class="n">beers</span><span class="c1">#new</span>
</span><span class='line'>   <span class="n">edit_beer</span> <span class="no">GET</span>    <span class="sr">/beer/e</span><span class="n">dit</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>    <span class="n">beers</span><span class="c1">#edit</span>
</span><span class='line'>             <span class="no">GET</span>    <span class="sr">/beer(.:format)         beers#show</span>
</span><span class='line'><span class="sr">             PUT    /</span><span class="n">beer</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>         <span class="n">beers</span><span class="c1">#update</span>
</span><span class='line'>             <span class="no">DELETE</span> <span class="sr">/beer(.:format)         beers#destroy</span>
</span><span class='line'><span class="sr">[2] pry(main)&gt; show-routes --grep beer</span>
</span><span class='line'><span class="sr">        beer POST   /</span><span class="n">beer</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>         <span class="n">beers</span><span class="c1">#create</span>
</span><span class='line'>    <span class="n">new_beer</span> <span class="no">GET</span>    <span class="sr">/beer/ne</span><span class="n">w</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>     <span class="n">beers</span><span class="c1">#new</span>
</span><span class='line'>   <span class="n">edit_beer</span> <span class="no">GET</span>    <span class="sr">/beer/e</span><span class="n">dit</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>    <span class="n">beers</span><span class="c1">#edit</span>
</span><span class='line'>             <span class="no">GET</span>    <span class="sr">/beer(.:format)         beers#show</span>
</span><span class='line'><span class="sr">             PUT    /</span><span class="n">beer</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>         <span class="n">beers</span><span class="c1">#update</span>
</span><span class='line'>             <span class="no">DELETE</span> <span class="sr">/beer(.:format)         beers#destroy</span>
</span><span class='line'><span class="sr">[3] pry(main)&gt; show-routes --grep new</span>
</span><span class='line'><span class="sr"> new_pokemon GET    /</span><span class="n">pokemon</span><span class="o">/</span><span class="kp">new</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>  <span class="n">pokemons</span><span class="c1">#new</span>
</span><span class='line'>    <span class="n">new_beer</span> <span class="no">GET</span>    <span class="sr">/beer/ne</span><span class="n">w</span><span class="p">(</span><span class="o">.</span><span class="ss">:format</span><span class="p">)</span>     <span class="n">beers</span><span class="c1">#new</span>
</span><span class='line'><span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">show</span><span class="o">-</span><span class="n">models</span>
</span><span class='line'><span class="no">Beer</span>
</span><span class='line'>  <span class="nb">id</span><span class="p">:</span> <span class="n">integer</span>
</span><span class='line'>  <span class="nb">name</span><span class="p">:</span> <span class="n">string</span>
</span><span class='line'>  <span class="ss">type</span><span class="p">:</span> <span class="n">string</span>
</span><span class='line'>  <span class="ss">rating</span><span class="p">:</span> <span class="n">integer</span>
</span><span class='line'>  <span class="ss">ibu</span><span class="p">:</span> <span class="n">integer</span>
</span><span class='line'>  <span class="ss">abv</span><span class="p">:</span> <span class="n">integer</span>
</span><span class='line'>  <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span class='line'>  <span class="n">updated_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="n">hacker</span>
</span><span class='line'><span class="no">Hacker</span>
</span><span class='line'>  <span class="nb">id</span><span class="p">:</span> <span class="n">integer</span>
</span><span class='line'>  <span class="n">social_ability</span><span class="p">:</span> <span class="n">integer</span>
</span><span class='line'>  <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span class='line'>  <span class="n">updated_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="n">pokemons</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="n">beers</span>
</span><span class='line'><span class="no">Pokemon</span>
</span><span class='line'>  <span class="nb">id</span><span class="p">:</span> <span class="n">integer</span>
</span><span class='line'>  <span class="nb">name</span><span class="p">:</span> <span class="n">string</span>
</span><span class='line'>  <span class="ss">caught</span><span class="p">:</span> <span class="n">binary</span>
</span><span class='line'>  <span class="ss">species</span><span class="p">:</span> <span class="n">string</span>
</span><span class='line'>  <span class="ss">abilities</span><span class="p">:</span> <span class="n">string</span>
</span><span class='line'>  <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span class='line'>  <span class="n">updated_at</span><span class="p">:</span> <span class="n">datetime</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="n">hacker</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="n">beers</span> <span class="n">through</span> <span class="n">hacker</span>
</span><span class='line'>
</span><span class='line'><span class="err">$</span> <span class="no">DISABLE_PRY_RAILS</span><span class="o">=</span><span class="mi">1</span> <span class="n">rails</span> <span class="n">console</span>
</span><span class='line'><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section id="about">
  <h1>About Me</h1>
  <img id="me" src="/images/me.jpg" alt="Zamith">

  <p>I&#8217;m the Co-Founder of <a href="http://www.groupbuddies.com/">Group Buddies</a></p>

  <p>I live in Braga, Portugal. I&#8217;m a geek, clean code lover and bballer.</p>

  <p>All opinions are my own and don&#8217;t necessarily reflect those of my employer.</p>

  <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a>

  <a href="mailto:luis@zamith.pt"><img id="pair-with-me" src="http://pairprogramwith.me/badge.png" alt="Pair program with me!" ></a>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/11/26/thoughts-on-experiments/">Thoughts on trying new things</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/05/supercharging-your-git/">Supercharging your git</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/22/vim-project-specific-config/">Vim project specific configs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/10/rust-vs-ruby/">Rust vs Ruby</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/02/autoreload-with-vim/">Autoreload with Vim</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/zamith">@zamith</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'zamith',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("zamith", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/zamith" class="twitter-follow-button" data-show-count="false">Follow @zamith</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Zamith -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'crazylittlehacks';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
